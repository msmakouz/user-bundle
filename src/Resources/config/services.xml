<?xml version="1.0" encoding="UTF-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services
        http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <defaults autowire="false" autoconfigure="false" public="false"/>

        <service id="zentlix_user.smtp_transport_factory" class="Zentlix\UserBundle\Infrastructure\Share\Mailer\Transport\SmtpTransportFactory">
            <argument type="service" id="zentlix_main.sites"/>
            <argument type="service" id="Zentlix\UserBundle\Domain\User\Repository\SiteRepository"/>
            <argument type="service" id="event_dispatcher" on-invalid="null"/>
            <argument type="service" id="Symfony\Contracts\HttpClient\HttpClientInterface" on-invalid="null"/>
            <argument type="service" id="Psr\Log\LoggerInterface" on-invalid="null"/>
            <tag name="mailer.transport_factory"/>
        </service>

        <service id="zentlix_user.admin_settings" class="Zentlix\UserBundle\Domain\Admin\Service\AdminSettings">
            <argument type="service" id="security.token_storage"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="zentlix_main.settings"/>
        </service>
        <service id="Zentlix\UserBundle\Domain\Admin\Service\AdminSettings" alias="zentlix_user.admin_settings"/>

        <service id="zentlix_user.mailer_providers" class="Zentlix\UserBundle\Domain\Mailer\Service\Providers">
            <argument type="tagged_iterator" tag="zentlix_user.mailer.provider"/>
        </service>
        <service id="Zentlix\UserBundle\Domain\Mailer\Service\Providers" alias="zentlix_user.mailer_providers"/>

        <service id="zentlix_user.mailer" class="Zentlix\UserBundle\Domain\Mailer\Service\Mailer">
            <argument type="service" id="zentlix_user.mailer_providers"/>
            <argument type="service" id="Zentlix\UserBundle\Domain\Mailer\Repository\TemplateRepository"/>
            <argument type="service" id="Zentlix\UserBundle\Domain\Mailer\Repository\EventRepository"/>
            <argument type="service" id="zentlix_main.sites"/>
        </service>
        <service id="Zentlix\UserBundle\Domain\Mailer\Service\Mailer" alias="zentlix_user.mailer"/>

        <service id="zentlix_user.authenticator" class="Zentlix\UserBundle\Domain\User\Service\Authenticator">
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="router"/>
            <argument type="service" id="security.csrf.token_manager"/>
            <argument type="service" id="security.password_encoder"/>
            <argument type="service" id="service_container"/>
            <argument type="service" id="translator"/>
            <argument type="service" id="event_dispatcher"/>
        </service>
        <service id="Zentlix\UserBundle\Domain\User\Service\Authenticator" alias="zentlix_user.authenticator"/>

        <!-- Listeners and Subscribers -->
        <service id="Zentlix\UserBundle\EventListener\LocaleListener">
            <argument type="service" id="session"/>
            <argument type="string" id="%kernel.default_locale%"/>
            <tag name="kernel.event_listener" event="kernel.request"/>
        </service>
        <service id="Zentlix\UserBundle\EventSubscriber\SidebarSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>
        <service id="Zentlix\UserBundle\EventSubscriber\SiteSubscriber">
            <argument type="service" id="zentlix_main.command_bus"/>
            <argument type="service" id="Zentlix\UserBundle\Domain\User\Repository\SiteRepository"/>
            <tag name="kernel.event_subscriber"/>
        </service>
        <service id="Zentlix\UserBundle\EventSubscriber\UserSubscriber">
            <argument type="service" id="Zentlix\UserBundle\Domain\Admin\Repository\SettingRepository"/>
            <argument type="service" id="doctrine.orm.entity_manager"/>
            <argument type="service" id="session"/>
            <tag name="kernel.event_subscriber"/>
        </service>
    </services>
</container>